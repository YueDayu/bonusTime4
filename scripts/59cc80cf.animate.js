function init(){setInitStatus(),randomCardId();var a=document.querySelector(".ip-slideshow");canvas=document.createElement("canvas"),canvas.width=innerWidth,canvas.height=700,a.appendChild(canvas),context=canvas.getContext("2d"),createText(200,0),createText(110,1),mainNum=max(next[0].length,next[1].length),console.log(mainNum),randomOrder(reOrder,0,mainNum),partNum=mainNum/3,createTextFrame(mainNum),createParticles()}function createParticles(){for(var a=0,b=mainNum;b>a;a++){var c,d,e=2*Math.PI*a/b;c=next[0][a].x,d=next[0][a].y;var f=randomBetween(0,12),g=!(f>0||12>f),h="#ffffff";particles.push({x:c,y:d,hasBorn:g,ease:.04+.06*Math.random(),bornSpeed:.03+.1*Math.random(),alpha:0,maxAlpha:.5+.5*Math.random(),radius:f,maxRadius:12,color:h,angle:0,steps:e})}loop()}function createText(a,b){context.font=a+"px Lato, Arial, sans-serif",context.fillStyle="rgb(255, 255, 255)",context.textAlign="center";var c=word[b].toUpperCase().split("").join(String.fromCharCode(8202));context.fillText(c,.5*canvas.width,.5*canvas.height+.5*a);for(var d=context.getImageData(.5*canvas.width-300,.5*canvas.height-.55*a,600,1.5*a),e=0;e<d.width;e+=0==b?6:8)for(var f=0;f<d.height;f+=4){var g=d.data[f*d.width*4+4*e-1],h=randomBetween(0,12),i=!(h>0||12>h);255===g&&next[b].push({x:e-300+.5*canvas.width,y:f-.55*a+.5*canvas.height,angle:0,hasBorn:i,ease:.04+.06*Math.random(),bornSpeed:.03+.1*Math.random(),alpha:0,maxAlpha:.5+.5*Math.random(),radius:h,orbit:randomBetween(15,25),maxRadius:12})}context.clearRect(.5*canvas.width-300,.5*canvas.height-.55*a,600,1.5*a)}function createTextFrame(a){for(var b,c,d=a/5.236,e=1.618*d,f=0,g=a;g>f;f++){d>f?(b=canvas.width/2-halfX,c=canvas.height/2-halfY+2*f*halfY/d):d+e>f?(c=canvas.height/2+halfY,b=canvas.width/2-halfX+2*(f-d)*halfX/e):2*d+e>f?(b=canvas.width/2+halfX,c=canvas.height/2-halfY+2*(f-d-e)*halfY/d):(c=canvas.height/2-halfY,b=canvas.width/2-halfX+2*(f-2*d-e)*halfX/e);var h=randomBetween(0,12),i=!(h>0||12>h);next[2].push({x:b,y:c,angle:0,hasBorn:i,ease:.04+.06*Math.random(),bornSpeed:.03+.1*Math.random(),alpha:0,maxAlpha:.5+.5*Math.random(),radius:h,maxRadius:12})}}function updataTransition(){switch(currentLayout){case 0:[].forEach.call(particles,function(a,b){var c=Math.floor(3*b/mainNum),d=b-Math.floor(c*partNum);switch(d%=Math.floor(partNum),randomNum[c]){case 0:var e=2*Math.PI*reOrder[d]/partNum;shape.x=.5*canvas.width+85*Math.cos(e),shape.y=.5*canvas.height+140*Math.sin(e);break;case 1:reOrder[d]<partNum/2?(shape.x=.5*canvas.width+1,shape.y=canvas.height/2-140+280*(reOrder[d]/partNum)):(shape.x=.5*canvas.width-1,shape.y=canvas.height/2+140-(reOrder[d]-partNum/2)/partNum*280);break;case 2:if(reOrder[d]<.435*partNum){var f=5*Math.PI/4*reOrder[d]/(.435*partNum);shape.x=.5*canvas.width-85*Math.cos(f),shape.y=.5*canvas.height-60-85*Math.sin(f)}else reOrder[d]<.78*partNum?(shape.x=.5*canvas.width+60-145*(reOrder[d]-.435*partNum)/(.345*partNum),shape.y=.5*canvas.height-5+147*(reOrder[d]-.435*partNum)/(.345*partNum)):(shape.x=.5*canvas.width-85+170*(reOrder[d]-.78*partNum)/(.22*partNum),shape.y=.5*canvas.height+140);break;case 3:if(reOrder[d]<93*partNum/200){var f=5*Math.PI/4*reOrder[d]/(93*partNum/200)-Math.PI/4;shape.x=.5*canvas.width+65*Math.sin(f),shape.y=.5*canvas.height-70-65*Math.cos(f)}else{var f=5*Math.PI/4*(reOrder[d]-93*partNum/200)/(107*partNum/200);shape.x=.5*canvas.width+75*Math.sin(f),shape.y=.5*canvas.height+70-75*Math.cos(f)}break;case 4:reOrder[d]<76*partNum/200?(shape.x=50+.5*canvas.width,shape.y=280*reOrder[d]/(76*partNum/200)+.5*canvas.height-140):reOrder[d]<127*partNum/200?(shape.y=.5*canvas.height+43,shape.x=.5*canvas.width-93+186*(reOrder[d]-76*partNum/200)/(51*partNum/200)):(shape.x=.5*canvas.width+50-143*(reOrder[d]-127*partNum/200)/(73*partNum/200),shape.y=.5*canvas.height-140+187*(reOrder[d]-127*partNum/200)/(73*partNum/200));break;case 5:if(reOrder[d]<46*partNum/200)shape.y=.5*canvas.height-140,shape.x=.5*canvas.width-75+150*reOrder[d]/(46*partNum/200);else if(reOrder[d]<86*partNum/200)shape.x=.5*canvas.width-75,shape.y=.5*canvas.height-140+100*(reOrder[d]-46*partNum/200)/(40*partNum/200);else if(reOrder[d]<109*partNum/200)shape.y=.5*canvas.height-40,shape.x=.5*canvas.width-75+75*(reOrder[d]-86*partNum/200)/(23*partNum/200);else{var f=19*Math.PI/14*(reOrder[d]-109*partNum/200)/(91*partNum/200);shape.x=.5*canvas.width+90*Math.sin(f),shape.y=.5*canvas.height+50-90*Math.cos(f)}break;case 6:if(reOrder[d]<60*partNum/200){var f=Math.PI*reOrder[d]/(60*partNum/200);shape.x=.5*canvas.width+85*Math.cos(f),shape.y=.5*canvas.height-55-85*Math.sin(f)}else if(reOrder[d]<80*partNum/200)shape.x=.5*canvas.width-85,shape.y=.5*canvas.height-55+110*(reOrder[d]-60*partNum/200)/(20*partNum/200);else{var f=2*Math.PI*(reOrder[d]-80*partNum/200)/(120*partNum/200);shape.x=.5*canvas.width+85*Math.sin(f),shape.y=.5*canvas.height+55+85*Math.cos(f)}break;case 7:reOrder[d]<70*partNum/200?(shape.y=.5*canvas.height-140,shape.x=.5*canvas.width-85+170*reOrder[d]/(70*partNum/200)):(shape.x=.5*canvas.width+85-100*(reOrder[d]-70*partNum/200)/(130*partNum/200),shape.y=.5*canvas.height-140+280*(reOrder[d]-70*partNum/200)/(130*partNum/200));break;case 8:if(reOrder[d]<92*partNum/200){var f=2*Math.PI*reOrder[d]/(92*partNum/200);shape.x=.5*canvas.width+65*Math.sin(f),shape.y=.5*canvas.height-75+65*Math.cos(f)}else{var f=2*Math.PI*(reOrder[d]-92*partNum/200)/(108*partNum/200);shape.x=.5*canvas.width+75*Math.sin(f),shape.y=.5*canvas.height+65+75*Math.cos(f)}break;case 9:if(reOrder[d]<60*partNum/200){var f=Math.PI*reOrder[d]/(60*partNum/200);shape.x=.5*canvas.width+85*Math.cos(f),shape.y=.5*canvas.height+55+85*Math.sin(f)}else if(reOrder[d]<80*partNum/200)shape.x=.5*canvas.width+85,shape.y=.5*canvas.height+55-110*(reOrder[d]-60*partNum/200)/(20*partNum/200);else{var f=2*Math.PI*(reOrder[d]-80*partNum/200)/(120*partNum/200);shape.x=.5*canvas.width+85*Math.sin(f),shape.y=.5*canvas.height-55+85*Math.cos(f)}}shape.x*=.6,shape.x+=.2*canvas.width,shape.y*=.6,shape.y+=144,shape.x+=(c-1)*gap,a.x+=.16*(shape.x+5*Math.cos(a.angle)-a.x),a.y+=.16*(shape.y+5*Math.sin(a.angle)-a.y),a.angle+=.08});break;default:[].forEach.call(particles,function(a,b){a.hasOwnProperty("x")&&(a.x+=.08*(next[currentLayout-1][reOrder[b]].x+5*Math.cos(a.angle)-a.x),a.y+=.08*(next[currentLayout-1][reOrder[b]].y+5*Math.sin(a.angle)-a.y),a.angle+=.08)})}}function update(){updataTransition(),[].forEach.call(particles,function(a,b){if(a.alpha+=.05*(a.maxAlpha-a.alpha),a.hasBorn){if(a.radius+=(0-a.radius)*a.bornSpeed,0===Math.round(a.radius)){switch(currentLayout){case 0:var c=Math.floor(3*b/mainNum);1==c?a.color=colors[1][Math.floor(Math.random()*colors[1].length)]:a.color=colors[2][Math.floor(Math.random()*colors[0].length)];break;case 1:case 2:a.color=colors[0][Math.floor(Math.random()*colors[0].length)];break;case 3:a.color=colors[3][Math.floor(Math.random()*colors[0].length)]}a.hasBorn=!1}}else a.radius+=(a.maxRadius-a.radius)*a.bornSpeed,Math.round(a.radius)===a.maxRadius&&(a.hasBorn=!0)})}function clear(){context.clearRect(0,0,canvas.width,canvas.height)}function randomBetween(a,b){var c=Math.floor(Math.random()*(b-a+1)+a);if(c==b){var c=Math.floor(Math.random()*(b-a+1)+a);c==b&&(c-=1)}return c}function max(a,b){return a>b?a:b}function render(){[].forEach.call(particles,function(a,b){context.save(),context.globalAlpha=a.alpha,context.fillStyle=a.color,context.beginPath(),context.arc(a.x,a.y,a.radius,0,2*Math.PI),context.fill(),context.restore()})}function loop(){clear(),update(),render(),setTimeout(loop,1e3/FPS)}function changeStatus(a){if(a%=4,2==a&&2!=currentLayout){randomOrder(reOrder,0,next[1].length);for(var b=0;b<next[2].length-next[1].length;b++)particles.pop()}else if(2==currentLayout&&2!=a){randomOrder(reOrder,0,mainNum);for(var b=0;b<next[2].length-next[1].length;b++){var c,d;c=.5*canvas.width,d=.5*canvas.height;var e=randomBetween(0,12),f=!(e>0||12>e),g="#ffffff";particles.push({x:c,y:d,hasBorn:f,ease:.04+.06*Math.random(),bornSpeed:.03+.1*Math.random(),alpha:0,maxAlpha:.5+.5*Math.random(),radius:e,maxRadius:12,color:g,angle:0})}}else randomOrder(reOrder,0,mainNum);0==a&&showNum(),currentLayout=a}function randomOrder(a,b,c){for(var d=0,e=b;c>e;e++)a[e]=e;for(var e=c;e>b;e--){d=randomBetween(b,e);var f=a[d];a[d]=a[e-1],a[e-1]=f}}function showNum(){if(0==currentLayout){for(var a=0;2>a;a++)randomOrder(reOrder,Math.floor(a*partNum),Math.floor((a+1)*partNum));randomOrder(reOrder,Math.floor(2*partNum),mainNum),randomNumberArray()}}function randomNumberArray(){randomNum[0]=randomBetween(0,maxHundredNum),randomNum[1]=randomBetween(0,10),randomNum[1]==randomNum[0]&&(randomNum[1]=randomBetween(0,10)),randomNum[2]=randomBetween(0,10),(randomNum[2]==randomNum[1]||randomNum[2]==randomNum[0])&&(randomNum[2]=randomBetween(0,10))}function hasClassName(a,b){var c=new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)");return c.test(a.className)}function addClassName(a,b){hasClassName(a,b)||(a.className=[a.className,b].join(" "))}function removeClassName(a,b){if(hasClassName(a,b)){var c=new RegExp("(?:^|\\s+)"+b+"(?:\\s+|$)","g"),d=a.className;a.className=d.replace(c," ")}}function moveToPosition(){for(var a=0;8>a;a++){var b=document.getElementById("card"+a);removeClassName(b,"card-over"),removeClassName(b,"to-center-card"+a),addClassName(b,"to-position-card"+a),removeClassName(b,"card-pic-center"),addClassName(b,"position-card"+a)}setTimeout(function(){for(var a=0;8>a;a++){var b=document.getElementById("card"+a);removeClassName(b,"to-position-card"+a)}},2010),setTimeout(function(){cardOverInOrder(0,0)},1900)}function cardOverInOrder(a,b){8>a&&(cardOver(a,b),setTimeout(function(){cardOverInOrder(a+1,b)},50),setTimeout(function(){var b=document.getElementById("card"+a);removeClassName(b,"card-over")},1050))}function cardOver(a,b){var c=document.getElementById("card"+a);removeClassName(c,"to-center-card"+a),removeClassName(c,"to-position-card"+a),addClassName(c,"card-over"),setTimeout(function(){0==b?isCardShow[a]?c.src="../images/"+showCardId[a]+".png":c.src="../images/card-word"+a+".png":1==b?c.src="../images/card.png":2==b?(isCardShow[a]=!0,c.src="../images/"+showCardId[a]+".png",setTimeout(function(){var b=document.getElementById("card"+a);removeClassName(b,"card-over")},1050)):c.src="../images/1.png"},500)}function moveToCenter(){cardOverInOrder(0,1),setTimeout(function(){for(var a=0;8>a;a++){var b=document.getElementById("card"+a);removeClassName(b,"card-over"),removeClassName(b,"to-position-card"+a),addClassName(b,"to-center-card"+a),removeClassName(b,"position-card"+a),addClassName(b,"card-pic-center")}setTimeout(function(){for(var a=0;8>a;a++){var b=document.getElementById("card"+a);removeClassName(b,"to-center-card"+a)}},1510)},1400)}function finalOver(){for(var a=0;7>a;a++){var b=document.getElementById("card"+a);addClassName(b,"hide")}cardOver(7,3),setTimeout(function(){var a=document.getElementById("card7");removeClassName(a,"card-over")},1050)}function finalBack(){cardOver(7,1),setTimeout(function(){var a=document.getElementById("card7");removeClassName(a,"card-over");for(var b=0;7>b;b++)a=document.getElementById("card"+b),removeClassName(a,"hide")},1050)}function randomCardId(){for(var a=0,b=7;b>=0;b--){var c=randomBetween(0,b+1);a=showCardId[b],showCardId[b]=showCardId[c],showCardId[c]=a}console.log(showCardId)}var self=window,halfX=450,halfY=250,reOrder=[],randomNum=[0,0,0],mainNum,partNum,currentLayout=1,gap=150,word=["安可","ENCORE"],particles=[],next=[[],[],[]],shape={},canvas,context,FPS=60,maxHundredNum=8,colors=[["#ffffff","#f7d838"],["#f7d838","#fee5d1"],["#9dcdb5","#fee5d1"],["#eb484f","#fee5d1"]];window.onload=init;var isCardShow=[!1,!1,!1,!1,!1,!1,!1,!1],showCardId=[2,3,4,5,6,7,8,9];